language: node_js
node_js:
- node
notifications:
  email: false
services:
- docker
env:
  global:
  - secure: DvEyqZtSz2gNh7gpbK6YWYRitvX6AqaG3GSDIOM4owpBnZWvQIFZSz28nzK62Z5Bp7a0LeuHEfQuUvaF8IYK8nHvhxCXH6mpihDIcf7F1IztRaMzdd2QrORKocfKCuxuS0+hJipzz1DHs0UtqrrvwGTULW2NIEPp6TSolyx6iDd4/zgXUK/bGlorLX2FJaY0HBYiJXU6uFw7k4uhsgzScNjitAaN7zG/rkCpYOZyxMl6xQLn3dAjSP1thTwigisp+K2K6mFncO1iECowDCSsbiySAOzYu5BfwIQxJD+Lg7FYT2WQIdOI+NJu2gGoliRXKB2cWR8sSFTbDmvaUQJVWlCX6ax1xHTMmUwlIuySbu75GDWE7a1V0YsjZcEfv17UYdv4r5+Mq//bdo93b+p2iMufwa0E3sBcCXOjwYezMZAzMLW1sVwHwUSmh97QAuIIzEip7wTjwXx7SgQ1ylO5NFZNzMKtOA/hr0lzeWd/Cp97+rtqq0nwc4ePDNriloS91i7J/MODyDVl3Uz35Q8Uc0+fN4wqYPBlKTfATX6fSNd3w7HEeAJJwOsQYQRrLuCtu4UJHZ9rg21SVIuxnmuRd73Q1UynKqu3up4489Gn0KvKeQBRI9MdA8Q2rvwjlJp+fPgXIusumONh7iEzkPaRfjftz+H6mMCgPNNaIvXRnW0=
before_install:
- sudo /etc/init.d/postgresql stop
- COMMIT_HASH=$(echo $TRAVIS_COMMIT | cut -c 1-7)
- IMAGE_TAG=${COMMIT_HASH:=latest}
- echo $IMAGE_TAG
script:
- echo Testing started on `date`
- echo Testing the Docker image...
- docker-compose -f docker-compose.ci.yml up --abort-on-container-exit --exit-code-from
  api --build
- echo Build started on `date`
- echo Building the Docker image...
- APP_NAME="$(cut -d'/' -f2 <<< $TRAVIS_REPO_SLUG)"
- DOCKER_USERNAME="leevilehtonen"
- docker login --username=_ --password=$HEROKU_TOKEN registry.heroku.com
- docker build -t $DOCKER_USERNAME/$APP_NAME:latest .
- docker tag $DOCKER_USERNAME/$APP_NAME:latest registry.heroku.com/$APP_NAME/web
- docker push registry.heroku.com/$APP_NAME/web
- heroku container:release web --app=$APP_NAME

